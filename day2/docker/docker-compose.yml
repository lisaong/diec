version: '3'
services:
  broker:
    image: eclipse-mosquitto
    ports:
      - '1883'

  microbit:
    image: lisaong/rpi-buster-pyota:1.0
    volumes:
      - ..:/code
    privileged: true
    depends_on:
      - broker
    command: >
      sh -c "cd /code/feeder 
      && python3 microbit_to_mqtt.py /dev/ttyACM0 --hostname broker"

  nutrient:
    image: lisaong/rpi-buster-pyota:1.0
    volumes:
      - ..:/code
    depends_on:
      - broker
    command: >
      sh -c "cd /code/feeder 
      && python3 nutrient_microservice.py /dev/ttyACM0 --hostname broker"

  iota:
    image: lisaong/rpi-buster-pyota:1.0
    volumes:
      - ..:/code
    depends_on:
      - broker
    command: >
      sh -c "cd /code/feeder 
      && python3 iota_microservice.py /dev/ttyACM0 --hostname broker"
